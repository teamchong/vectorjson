--- node_modules/@tanstack/ai/dist/esm/activities/chat/stream/processor.js	2026-02-16 09:48:19.186470448 -0500
+++ node_modules/@tanstack/ai/dist/esm/activities/chat/stream/processor.js	2026-02-16 09:50:03.489165846 -0500
@@ -1,3 +1,14 @@
+import { init as vjInit } from "../../../../../../../../../../dist/index.js";
+var __vjInstance = null;
+var __vjParsers = new Map();
+(async () => {
+  __vjInstance = await vjInit();
+})();
+function __getOrCreateParser(toolCallId) {
+  let p = __vjParsers.get(toolCallId);
+  if (!p && __vjInstance) { p = __vjInstance.createParser(); __vjParsers.set(toolCallId, p); }
+  return p;
+}
 import { generateMessageId, uiMessageToModelMessages } from "../messages.js";
 import { defaultJSONParser } from "./json-parser.js";
 import { updateToolCallWithOutput, updateToolResultPart, updateToolCallApprovalResponse, updateToolCallPart, updateThinkingPart, updateToolCallApproval, updateTextPart } from "./message-updaters.js";
@@ -402,9 +413,19 @@
       if (wasAwaitingInput && chunk.delta) {
         existingToolCall.state = "input-streaming";
       }
-      existingToolCall.parsedArguments = this.jsonParser.parse(
-        existingToolCall.arguments
-      );
+      // VectorJSON: feed only the new delta (O(delta) not O(buffer))
+      const __vjp = __getOrCreateParser(toolCallId);
+      if (__vjp && chunk.delta) {
+        __vjp.feed(chunk.delta);
+        const val = __vjp.getValue();
+        if (val !== undefined) {
+          existingToolCall.parsedArguments = typeof val === "object" && val ? __vjInstance.materialize(val) : val;
+        } else {
+          existingToolCall.parsedArguments = this.jsonParser.parse(existingToolCall.arguments);
+        }
+      } else {
+        existingToolCall.parsedArguments = this.jsonParser.parse(existingToolCall.arguments);
+      }
       if (this.currentAssistantMessageId) {
         this.messages = updateToolCallPart(
           this.messages,
@@ -442,6 +463,9 @@
    */
   handleToolCallEndEvent(chunk) {
     const existingToolCall = this.toolCalls.get(chunk.toolCallId);
+    // VectorJSON: clean up parser for this tool call
+    const __vjp = __vjParsers.get(chunk.toolCallId);
+    if (__vjp) { __vjp.destroy(); __vjParsers.delete(chunk.toolCallId); }
     if (existingToolCall && existingToolCall.state !== "input-complete") {
       const index = this.toolCallOrder.indexOf(chunk.toolCallId);
       this.completeToolCall(index, existingToolCall);
